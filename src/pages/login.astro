---
import Layout from '../layouts/Layout.astro';
---

<Layout title="FirstRep - Login / Sign Up">
	<main class="max-w-md mx-auto px-6 py-20 text-center">
		<h1 class="text-4xl font-black mb-2 tracking-tight">
			First<span class="text-indigo-500">Rep</span>
		</h1>
		<p class="text-gray-400 mb-12">Sign in to save your progress.</p>

		<div class="bg-gray-900 border border-gray-800 p-8 rounded-2xl shadow-xl text-left">
			<form id="auth-form" class="space-y-6">
				<div>
					<label for="email" class="block text-xs font-medium mb-2 text-gray-500 uppercase tracking-widest">Email Address</label>
					<input type="email" id="email" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:ring-2 focus:ring-indigo-500 outline-none transition" placeholder="you@example.com" required />
				</div>
				<div>
					<label for="password" class="block text-xs font-medium mb-2 text-gray-500 uppercase tracking-widest">Password</label>
					<input type="password" id="password" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 focus:ring-2 focus:ring-indigo-500 outline-none transition" placeholder="••••••••" required />
				</div>
				
				<div class="space-y-3 pt-4">
					<button type="submit" id="btn-login" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 rounded-xl transition shadow-lg shadow-indigo-500/20 active:scale-[0.98]">
						Sign In
					</button>
					<button type="button" id="btn-signup" class="w-full bg-transparent border border-gray-700 hover:border-gray-500 text-gray-300 font-bold py-4 rounded-xl transition active:scale-[0.98]">
						Create Account
					</button>
				</div>
			</form>
			<p id="auth-msg" class="hidden mt-6 text-center text-sm font-medium"></p>
		</div>

		<p class="mt-8 text-sm text-gray-500">
			By signing in, you agree to our <span class="text-gray-400 underline cursor-pointer">Terms of Service</span>.
		</p>
	</main>
</Layout>

<script>
	import { supabase } from '../lib/supabase';

	const form = document.getElementById('auth-form');
	const emailInput = document.getElementById('email') as HTMLInputElement;
	const passwordInput = document.getElementById('password') as HTMLInputElement;
	const btnLogin = document.getElementById('btn-login');
	const btnSignup = document.getElementById('btn-signup');
	const msg = document.getElementById('auth-msg');

	function showMsg(text: string, isError = false) {
		msg.innerText = text;
		msg.className = `mt-6 text-center text-sm font-medium ${isError ? 'text-red-400' : 'text-green-400'}`;
		msg.classList.remove('hidden');
	}

	btnSignup?.addEventListener('click', async () => {
		const email = emailInput.value;
		const password = passwordInput.value;
		if (!email || !password) return showMsg('Enter email and password.', true);

		const { error } = await supabase.auth.signUp({ email, password });
		if (error) showMsg(error.message, true);
		else showMsg('Check your email for a confirmation link!');
	});

	form?.addEventListener('submit', async (e) => {
		e.preventDefault();
		const email = emailInput.value;
		const password = passwordInput.value;

		const { error } = await supabase.auth.signInWithPassword({ email, password });
		if (error) showMsg(error.message, true);
		else {
			showMsg('Success! Redirecting...');
			window.location.href = '/FirstRep/';
		}
	});

	async function checkSession() {
		const { data: { session } } = await supabase.auth.getSession();
		if (session) {
			window.location.href = '/FirstRep/';
		}
	}
	checkSession();
</script>
